## MindWave Blink Keyboard (WPF C# Assistive Input)

### Project Summary

This Windows WPF application provides a **hands-free virtual keyboard** that lets users compose and send text using intentional eye blinks detected by a NeuroSky MindWave headset (via the ThinkGear Connector). The app connects to the connector over TCP, parses JSON blink data, and uses a two-phase scanning selection (horizontal → vertical) with timers to highlight and programmatically “press” virtual buttons. It includes UI feedback, logging, and a Notepad-targeted send feature.

---

### Core Features

* Real-time connection to **ThinkGear Connector** (127.0.0.1:13854) and JSON-based blink data parsing.
* Two-phase scanning selection: **Horizontal** (cycle across row) → **Vertical** (cycle down column) → **Press**.
* Blink classification: intentional blinks (strength ≥ 70) trigger selection actions.
* Timers: a `System.Threading.Timer` controls phase transitions and action timeouts; a `DispatcherTimer` drives the visible countdown.
* Visual feedback: highlighted buttons, countdown UI (`TimerText`), and a logging window (`LogOutput`).
* Programmatic button activation: selected buttons are raised (`RaiseEvent`) to perform their action.
* Send composed text to another application (default: Notepad) using `SetForegroundWindow` (P/Invoke) and `SendKeys`.
* Robust UI marshalling using `Dispatcher.Invoke` for thread-safety.
* JSON deserialization via **Newtonsoft.Json**; resources embedded via auto-generated `Resources.Designer.cs`.
* Graceful fallback for malformed packets (logged, ignored).

---

### Key Methods and Algorithms

* **TCP Listener & JSON Parsing**

  * Opens a `TcpClient` to ThinkGear Connector, writes a JSON config `{"enableRawOutput":false,"format":"Json"}`, then continuously reads the stream.
  * Uses `JsonConvert.DeserializeObject<BlinkData>()` to extract `BlinkStrength`.

* **Blink Event Handling**

  * `HandleHitDetected()` runs on the UI thread (via `Dispatcher`) and:

    * Starts/refreshes the selection timers.
    * Moves selection horizontally or vertically depending on `SelectionPhase`.
    * Updates visual state and logs actions.

* **Two-Phase Scanning Logic**

  * **Horizontal phase:** each blink advances selection across a row; timer resets after every blink. If timer expires → switch to vertical.
  * **Vertical phase:** blinks move selection down the selected column; timer expiry triggers `PressButton()` (the selected button is programmatically clicked) and the system resets to Idle.
  * Selection mapping uses index rules to map the UI grid to button names (e.g., `_11`, `_22`, etc.).

* **Timers & UI Synchronization**

  * `System.Threading.Timer clearTimer` (background) for selection timeouts and phase changes.
  * `DispatcherTimer uiTimer` for a second-by-second countdown displayed to the user.
  * All UI updates are marshalled with `Dispatcher.Invoke` to ensure thread-safety.

* **Programmatic Input Forwarding**

  * Uses `Process.GetProcesses()` to find a target window (default `"Notepad"`), `SetForegroundWindow` to focus it, then `SendKeys.SendWait` to paste the composed text and optionally send Enter.

* **Resilience & Safety**

  * Malformed or partial JSON packets are caught and ignored to prevent crashes.
  * The app logs connection attempts, successes, errors, and disconnections.

---

### Skills Demonstrated

* WPF application design and event-driven UI programming.
* Multithreaded programming and safe UI-thread marshaling (`Dispatcher`).
* TCP socket programming for real-time data streams.
* JSON serialization/deserialization with **Newtonsoft.Json**.
* P/Invoke (`user32.dll` / `SetForegroundWindow`) and inter-process input automation (`SendKeys`).
* Designing accessible input methods and assistive interaction patterns (scanning keyboard).
* Timers and state machine implementation for human-in-the-loop interfaces.
* Resource management and integration of autogenerated resource code.

---

### File Overview

| File Name                      | Description                                                                                               |
| ------------------------------ | --------------------------------------------------------------------------------------------------------- |
| **App.xaml.cs**                | WPF application entry/boot class.                                                                         |
| **AssemblyInfo.cs**            | Assembly theme info and metadata.                                                                         |
| **blinkdata.cs**               | `BlinkData` model representing incoming JSON blink data.                                                  |
| **MainWindow.xaml / .xaml.cs** | Main UI layout and `MainWindow` logic, timers, selection algorithm, button handlers, logging, send logic. |
| **Resources.Designer.cs**      | Auto-generated resource accessor (e.g., embedded brain byte[]).                                           |

---

### How to Build & Run

1. **Prerequisites**

   * Windows OS.
   * Visual Studio (2017 or later) or MSBuild targeting .NET Framework 4.x.
   * **ThinkGear Connector** (NeuroSky) installed and running, configured to expose JSON on `127.0.0.1:13854`.
   * NuGet package: **Newtonsoft.Json**.

2. **Open & Restore**

   * Open the solution/project in Visual Studio and restore NuGet packages.

3. **Run**

   * Start the ThinkGear Connector, then launch the WPF app from Visual Studio (F5) or run the built `.exe`.
   * The app logs connection attempts; when connected, blink the MindWave headset (intentional blinks ≥70) to interact.

4. **Testing without Hardware**

   * You may simulate incoming JSON by running a simple TCP server that sends lines like `{"BlinkStrength":80}` to port `13854`.

---

### Considerations & Limitations

* **Research/Educational Use Only** — not a certified medical device. 
* **ThinkGear Dependency** — user must obtain NeuroSky software and connector separately.
* **No Auto-Reconnect** — on disconnection the app logs an error but does not attempt automatic reconnection.
* **SendKeys Limitations** — `SendKeys` and window focusing are OS-level hacks; they can fail with certain elevated processes or sandboxed apps.
* **Timing Parameters** — default 5s timer may need personalization for different users; expose as user setting if needed.
* **Privacy & Security** — data transmitted over loopback only; still treat EEG-derived data sensitively.

---
